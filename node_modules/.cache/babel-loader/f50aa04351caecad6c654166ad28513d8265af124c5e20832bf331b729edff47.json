{"ast":null,"code":"import _regeneratorRuntime from \"/Users/vivian/Desktop/today-i-learned/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/vivian/Desktop/today-i-learned/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _createClass from \"/Users/vivian/Desktop/today-i-learned/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _classCallCheck from \"/Users/vivian/Desktop/today-i-learned/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _inherits from \"/Users/vivian/Desktop/today-i-learned/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/vivian/Desktop/today-i-learned/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _wrapNativeSuper from \"/Users/vivian/Desktop/today-i-learned/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js\";\nvar _navigatorLock;\nimport { supportsLocalStorage } from './helpers';\n/**\n * @experimental\n */\nexport var internals = {\n  /**\n   * @experimental\n   */\n  debug: !!(globalThis && supportsLocalStorage() && globalThis.localStorage && globalThis.localStorage.getItem('supabase.gotrue-js.locks.debug') === 'true')\n};\nexport var LockAcquireTimeoutError = /*#__PURE__*/function (_Error) {\n  _inherits(LockAcquireTimeoutError, _Error);\n  var _super = _createSuper(LockAcquireTimeoutError);\n  function LockAcquireTimeoutError(message) {\n    var _this;\n    _classCallCheck(this, LockAcquireTimeoutError);\n    _this = _super.call(this, message);\n    _this.isAcquireTimeout = true;\n    return _this;\n  }\n  return _createClass(LockAcquireTimeoutError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nexport var NavigatorLockAcquireTimeoutError = /*#__PURE__*/function (_LockAcquireTimeoutEr) {\n  _inherits(NavigatorLockAcquireTimeoutError, _LockAcquireTimeoutEr);\n  var _super2 = _createSuper(NavigatorLockAcquireTimeoutError);\n  function NavigatorLockAcquireTimeoutError() {\n    _classCallCheck(this, NavigatorLockAcquireTimeoutError);\n    return _super2.apply(this, arguments);\n  }\n  return _createClass(NavigatorLockAcquireTimeoutError);\n}(LockAcquireTimeoutError);\n/**\n * Implements a global exclusive lock using the Navigator LockManager API. It\n * is available on all browsers released after 2022-03-15 with Safari being the\n * last one to release support. If the API is not available, this function will\n * throw. Make sure you check availablility before configuring {@link\n * GoTrueClient}.\n *\n * You can turn on debugging by setting the `supabase.gotrue-js.locks.debug`\n * local storage item to `true`.\n *\n * Internals:\n *\n * Since the LockManager API does not preserve stack traces for the async\n * function passed in the `request` method, a trick is used where acquiring the\n * lock releases a previously started promise to run the operation in the `fn`\n * function. The lock waits for that promise to finish (with or without error),\n * while the function will finally wait for the result anyway.\n *\n * @experimental\n *\n * @param name Name of the lock to be acquired.\n * @param acquireTimeout If negative, no timeout. If 0 an error is thrown if\n *                       the lock can't be acquired without waiting. If positive, the lock acquire\n *                       will time out after so many milliseconds. An error is\n *                       a timeout if it has `isAcquireTimeout` set to true.\n * @param fn The operation to run once the lock is acquired.\n */\nexport function navigatorLock(_x, _x2, _x3) {\n  return (_navigatorLock = _navigatorLock || _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(name, acquireTimeout, fn) {\n    var _ref;\n    var abortController;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          if (internals.debug) {\n            console.log('@supabase/gotrue-js: navigatorLock: acquire lock', name, acquireTimeout);\n          }\n          abortController = new globalThis.AbortController();\n          if (acquireTimeout > 0) {\n            setTimeout(function () {\n              abortController.abort();\n              if (internals.debug) {\n                console.log('@supabase/gotrue-js: navigatorLock acquire timed out', name);\n              }\n            }, acquireTimeout);\n          }\n          // MDN article: https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request\n          _context2.next = 5;\n          return globalThis.navigator.locks.request(name, acquireTimeout === 0 ? {\n            mode: 'exclusive',\n            ifAvailable: true\n          } : {\n            mode: 'exclusive',\n            signal: abortController.signal\n          }, function (_x4) {\n            return (_ref = _ref || _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(lock) {\n              var result;\n              return _regeneratorRuntime().wrap(function _callee$(_context) {\n                while (1) switch (_context.prev = _context.next) {\n                  case 0:\n                    if (!lock) {\n                      _context.next = 11;\n                      break;\n                    }\n                    if (internals.debug) {\n                      console.log('@supabase/gotrue-js: navigatorLock: acquired', name, lock.name);\n                    }\n                    _context.prev = 2;\n                    _context.next = 5;\n                    return fn();\n                  case 5:\n                    return _context.abrupt(\"return\", _context.sent);\n                  case 6:\n                    _context.prev = 6;\n                    if (internals.debug) {\n                      console.log('@supabase/gotrue-js: navigatorLock: released', name, lock.name);\n                    }\n                    return _context.finish(6);\n                  case 9:\n                    _context.next = 31;\n                    break;\n                  case 11:\n                    if (!(acquireTimeout === 0)) {\n                      _context.next = 16;\n                      break;\n                    }\n                    if (internals.debug) {\n                      console.log('@supabase/gotrue-js: navigatorLock: not immediately available', name);\n                    }\n                    throw new NavigatorLockAcquireTimeoutError(\"Acquiring an exclusive Navigator LockManager lock \\\"\".concat(name, \"\\\" immediately failed\"));\n                  case 16:\n                    if (!internals.debug) {\n                      _context.next = 27;\n                      break;\n                    }\n                    _context.prev = 17;\n                    _context.next = 20;\n                    return globalThis.navigator.locks.query();\n                  case 20:\n                    result = _context.sent;\n                    console.log('@supabase/gotrue-js: Navigator LockManager state', JSON.stringify(result, null, '  '));\n                    _context.next = 27;\n                    break;\n                  case 24:\n                    _context.prev = 24;\n                    _context.t0 = _context[\"catch\"](17);\n                    console.warn('@supabase/gotrue-js: Error when querying Navigator LockManager state', _context.t0);\n                  case 27:\n                    // Browser is not following the Navigator LockManager spec, it\n                    // returned a null lock when we didn't use ifAvailable. So we can\n                    // pretend the lock is acquired in the name of backward compatibility\n                    // and user experience and just run the function.\n                    console.warn('@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request');\n                    _context.next = 30;\n                    return fn();\n                  case 30:\n                    return _context.abrupt(\"return\", _context.sent);\n                  case 31:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }, _callee, null, [[2,, 6, 9], [17, 24]]);\n            }))).apply(this, arguments);\n          });\n        case 5:\n          return _context2.abrupt(\"return\", _context2.sent);\n        case 6:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }))).apply(this, arguments);\n}","map":{"version":3,"names":["supportsLocalStorage","internals","debug","globalThis","localStorage","getItem","LockAcquireTimeoutError","_Error","_inherits","_super","_createSuper","message","_this","_classCallCheck","call","isAcquireTimeout","_createClass","_wrapNativeSuper","Error","NavigatorLockAcquireTimeoutError","_LockAcquireTimeoutEr","_super2","apply","arguments","navigatorLock","_x","_x2","_x3","_navigatorLock","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","name","acquireTimeout","fn","_ref","abortController","wrap","_callee2$","_context2","prev","next","console","log","AbortController","setTimeout","abort","navigator","locks","request","mode","ifAvailable","signal","_x4","_callee","lock","result","_callee$","_context","abrupt","sent","finish","concat","query","JSON","stringify","t0","warn","stop"],"sources":["/Users/vivian/Desktop/today-i-learned/node_modules/@supabase/gotrue-js/src/lib/locks.ts"],"sourcesContent":["import { supportsLocalStorage } from './helpers'\n\n/**\n * @experimental\n */\nexport const internals = {\n  /**\n   * @experimental\n   */\n  debug: !!(\n    globalThis &&\n    supportsLocalStorage() &&\n    globalThis.localStorage &&\n    globalThis.localStorage.getItem('supabase.gotrue-js.locks.debug') === 'true'\n  ),\n}\n\nexport abstract class LockAcquireTimeoutError extends Error {\n  public readonly isAcquireTimeout = true\n\n  constructor(message: string) {\n    super(message)\n  }\n}\n\nexport class NavigatorLockAcquireTimeoutError extends LockAcquireTimeoutError {}\n\n/**\n * Implements a global exclusive lock using the Navigator LockManager API. It\n * is available on all browsers released after 2022-03-15 with Safari being the\n * last one to release support. If the API is not available, this function will\n * throw. Make sure you check availablility before configuring {@link\n * GoTrueClient}.\n *\n * You can turn on debugging by setting the `supabase.gotrue-js.locks.debug`\n * local storage item to `true`.\n *\n * Internals:\n *\n * Since the LockManager API does not preserve stack traces for the async\n * function passed in the `request` method, a trick is used where acquiring the\n * lock releases a previously started promise to run the operation in the `fn`\n * function. The lock waits for that promise to finish (with or without error),\n * while the function will finally wait for the result anyway.\n *\n * @experimental\n *\n * @param name Name of the lock to be acquired.\n * @param acquireTimeout If negative, no timeout. If 0 an error is thrown if\n *                       the lock can't be acquired without waiting. If positive, the lock acquire\n *                       will time out after so many milliseconds. An error is\n *                       a timeout if it has `isAcquireTimeout` set to true.\n * @param fn The operation to run once the lock is acquired.\n */\nexport async function navigatorLock<R>(\n  name: string,\n  acquireTimeout: number,\n  fn: () => Promise<R>\n): Promise<R> {\n  if (internals.debug) {\n    console.log('@supabase/gotrue-js: navigatorLock: acquire lock', name, acquireTimeout)\n  }\n\n  const abortController = new globalThis.AbortController()\n\n  if (acquireTimeout > 0) {\n    setTimeout(() => {\n      abortController.abort()\n      if (internals.debug) {\n        console.log('@supabase/gotrue-js: navigatorLock acquire timed out', name)\n      }\n    }, acquireTimeout)\n  }\n\n  // MDN article: https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request\n\n  return await globalThis.navigator.locks.request(\n    name,\n    acquireTimeout === 0\n      ? {\n          mode: 'exclusive',\n          ifAvailable: true,\n        }\n      : {\n          mode: 'exclusive',\n          signal: abortController.signal,\n        },\n    async (lock) => {\n      if (lock) {\n        if (internals.debug) {\n          console.log('@supabase/gotrue-js: navigatorLock: acquired', name, lock.name)\n        }\n\n        try {\n          return await fn()\n        } finally {\n          if (internals.debug) {\n            console.log('@supabase/gotrue-js: navigatorLock: released', name, lock.name)\n          }\n        }\n      } else {\n        if (acquireTimeout === 0) {\n          if (internals.debug) {\n            console.log('@supabase/gotrue-js: navigatorLock: not immediately available', name)\n          }\n\n          throw new NavigatorLockAcquireTimeoutError(\n            `Acquiring an exclusive Navigator LockManager lock \"${name}\" immediately failed`\n          )\n        } else {\n          if (internals.debug) {\n            try {\n              const result = await globalThis.navigator.locks.query()\n\n              console.log(\n                '@supabase/gotrue-js: Navigator LockManager state',\n                JSON.stringify(result, null, '  ')\n              )\n            } catch (e: any) {\n              console.warn(\n                '@supabase/gotrue-js: Error when querying Navigator LockManager state',\n                e\n              )\n            }\n          }\n\n          // Browser is not following the Navigator LockManager spec, it\n          // returned a null lock when we didn't use ifAvailable. So we can\n          // pretend the lock is acquired in the name of backward compatibility\n          // and user experience and just run the function.\n          console.warn(\n            '@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request'\n          )\n\n          return await fn()\n        }\n      }\n    }\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}